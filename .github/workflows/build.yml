name: 📱 Build Android APK

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-apk:
    runs-on: ubuntu-20.04
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v3
      
    - name: 🐍 Setup Python  
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
        
    - name: ☕ Setup Java
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '8'
        
    - name: 🔧 Install system dependencies
      run: |
        sudo apt update
        sudo apt install -y build-essential ccache git libncurses5:i386 libstdc++6:i386 libgtk2.0-0:i386 libpangox-1.0-0:i386 libpangoxft-1.0-0:i386 libidn11:i386 python2.7 python2.7-dev openjdk-8-jdk unzip zlib1g-dev zlib1g:i386
        
    - name: 🐍 Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install buildozer==1.4.0 cython
        
    - name: 🏗️ Build APK
      run: |
        buildozer android debug
        
    - name: 📱 Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: gestor-obras-android-apk
        path: bin/*.apk
        
    - name: 📊 Show build info
      run: |
        if [ -f bin/*.apk ]; then
          echo "✅ APK generado exitosamente!"
          ls -la bin/*.apk
        else
          echo "❌ No se generó APK"
        fi
